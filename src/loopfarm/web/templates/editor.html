{% extends "base.html" %}
{% set active_nav = "dashboard" %}
{% from "_tree_node.html" import render_node %}

{% block title %}loopfarm - {{ root.title[:48] }}{% endblock %}

{% block content %}
<div class="editor-shell">
  <section class="editor-toolbar" aria-label="Issue context and runner controls">
    <div class="editor-toolbar-main">
      <div class="emes-breadcrumb" id="breadcrumb">
        <a href="/">dashboard</a>
        <span class="emes-breadcrumb-sep">/</span>
        <span id="breadcrumb-trail">{{ root.title[:80] }}</span>
      </div>
      <p class="editor-toolbar-sub">Navigate the DAG on the left and inspect or update selected issues on the right.</p>
    </div>

    <div class="editor-toolbar-actions">
      <span class="runner-pill" id="runner-status">{{ runner_state.status }}</span>
      <button class="emes-btn-sm emes-btn-green" id="btn-run" onclick="startRunner()">run</button>
      <button class="emes-btn-sm" id="btn-pause" onclick="pauseRunner()">pause</button>
    </div>
  </section>

  <section class="editor-layout">
    <aside class="editor-tree-pane" id="tree-pane" aria-label="Issue tree">
      <div class="pane-header">
        <h2 class="pane-title">Issue Graph</h2>
        <p class="pane-subtitle">Keyboard: <kbd>j</kbd>/<kbd>k</kbd> move, <kbd>enter</kbd> open, <kbd>/</kbd> search.</p>
      </div>
      <div class="tree-container" id="tree-container">
        {{ render_node(tree) }}
      </div>
    </aside>

    <section class="editor-detail-pane" id="detail-pane" aria-label="Issue detail panel">
      {% include "_detail_panel.html" %}
    </section>
  </section>
</div>

<script>
  window.__rootId = "{{ root.id }}";
</script>
{% endblock %}
